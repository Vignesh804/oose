<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Road Safety Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            color: #333;
            background-color: #f4f4f4;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background-color: #1a3a6e;
            color: #fff;
            padding: 15px 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            text-decoration: none;
        }

        .logo span {
            color: #ffcc00;
        }

        .nav {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .nav-link {
            color: #fff;
            text-decoration: none;
            font-size: 15px;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 10px;
            border-radius: 5px;
            transition: background-color 0.3s, color 0.3s;
            white-space: nowrap;
        }

        .nav-link:hover,
        .nav-link.active {
            background-color: #ffcc00;
            color: #1a3a6e;
        }

        .logged-in-item, .logged-out-item {
            display: none;
        }

        .main {
            padding: 30px 0;
            flex-grow: 1;
        }

        .form-container {
            display: none;
            min-height: 70vh;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            padding: 0;
        }

        .form-container.active {
            display: block;
        }

        .form-container::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }

        .form-container > .container {
            padding-top: 30px;
            padding-bottom: 30px;
            position: relative;
            z-index: 2;
        }

        #home-section {
            background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1568605117036-5fe5e7bab0b7?q=80&w=1470&auto=format&fit=crop');
        }

        #home-section::before {
            background: rgba(0, 0, 0, 0.6);
        }

        #login-section {
            background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1558981403-c5f9899a28bc?q=80&w=1470&auto=format&fit=crop');
        }

        #login-section::before {
            background: rgba(0, 0, 0, 0.6);
        }

        #register-section {
            background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1589156280159-27698a70f29e?q=80&w=1470&auto=format&fit=crop');
        }

        #register-section::before {
            background: rgba(0, 0, 0, 0.6);
        }

        #dashboard-section {
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1454165804606-c3d57bc86b40?q=80&w=1470&auto=format&fit=crop');
            background-attachment: fixed;
            background-size: cover;
            background-position: center;
        }

        #dashboard-section::before {
            background: rgba(0, 0, 0, 0.7);
        }

        #report-accident-section {
            background-image: linear-gradient(rgba(0, 0, 0, 0.65), rgba(0, 0, 0, 0.65)), url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?q=80&w=1470&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }

        #report-accident-section::before {
            background: rgba(0, 0, 0, 0.65);
        }

        #view-violations-section {
            background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1504214208698-ea1916a2195a?q=80&w=1470&auto=format&fit=crop');
        }

        #view-violations-section::before {
            background: rgba(0, 0, 0, 0.6);
        }

        #pay-fines-section {
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://images.unsplash.com/photo-1550565118-3a701e361cd8?q=80&w=1470&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }

        #pay-fines-section::before {
            background: rgba(0, 0, 0, 0.7);
        }

        #acts-rules-section {
            background-image: linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.6)), url('https://images.unsplash.com/photo-1589829545856-d10d557cf95f?q=80&w=1470&auto=format&fit=crop');
        }

        #acts-rules-section::before {
            background: rgba(0, 0, 0, 0.6);
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            border: 1px solid #e0e0e0;
        }

        #dashboard-section .card {
            background: rgba(255, 255, 255, 0.98);
        }

        .card-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #1a3a6e;
            display: flex;
            align-items: center;
            gap: 10px;
            border-bottom: 2px solid #ffcc00;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-control {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        .form-control:focus {
            border-color: #1a3a6e;
            outline: none;
            box-shadow: 0 0 5px rgba(26, 58, 110, 0.3);
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #333;
        }

        .btn {
            background-color: #1a3a6e;
            color: #fff;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: background-color 0.3s, transform 0.1s;
            text-decoration: none;
        }

        .btn:hover {
            background-color: #ffcc00;
            color: #1a3a6e;
            transform: translateY(-1px);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-lg {
            padding: 14px 25px;
            font-size: 18px;
        }

        .btn-sm {
            padding: 8px 15px;
            font-size: 14px;
        }

        .btn-success {
            background-color: #28a745;
        }

        .btn-success:hover {
            background-color: #218838;
            color: #fff;
        }

        .btn-secondary {
            background-color: #6c757d;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
            color: #fff;
        }

        .feedback-message {
            display: none;
            padding: 12px;
            border-radius: 5px;
            margin-top: 15px;
            text-align: center;
            font-weight: bold;
        }

        .feedback-message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .feedback-message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .hero {
            text-align: center;
            padding: 40px 20px;
            color: #fff;
            border-radius: 8px;
            margin-bottom: 30px;
            background: linear-gradient(135deg, #1a3a6e 0%, #ffcc00 100%);
        }

        .hero .card-title {
            color: #fff;
            border: none;
            justify-content: center;
            font-size: 28px;
            margin-bottom: 15px;
        }

        .hero .hero-subtitle {
            font-size: 18px;
            margin: 20px 0;
            color: #eee;
        }

        .hero .hero-actions .btn {
            margin: 0 10px;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .feature {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .feature-icon {
            font-size: 40px;
            color: #1a3a6e;
            margin-bottom: 15px;
        }

        .feature-content h3 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #1a3a6e;
        }

        .feature-content p {
            font-size: 14px;
            color: #555;
            line-height: 1.5;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            text-align: center;
        }

        .stat {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 28px;
            font-weight: bold;
            color: #1a3a6e;
            margin-bottom: 10px;
        }

        #dashboard-section .welcome-card {
            background-color: #1a3a6e;
            color: #fff;
            border: none;
            margin-bottom: 30px;
        }

        #dashboard-section .welcome-card .card-title {
            color: #ffcc00;
            border-bottom: none;
            padding-bottom: 0;
            margin-bottom: 10px;
        }

        #dashboard-section .welcome-card p {
            color: #eee;
            font-size: 16px;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
        }

        .dashboard-main {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .dashboard-sidebar {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .stats-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .stats-card {
            text-align: center;
            padding: 20px;
            margin-bottom: 0;
        }

        .stats-icon {
            font-size: 28px;
            color: #1a3a6e;
            margin-bottom: 8px;
        }

        .stats-value {
            font-size: 32px;
            font-weight: bold;
            color: #1a3a6e;
            margin-bottom: 5px;
        }

        .stats-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }

        .stats-card .btn {
            margin-top: 10px;
        }

        .quick-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
        }

        .quick-action-item {
            text-align: center;
            padding: 15px;
            border: 1px solid #eee;
            border-radius: 6px;
            transition: background-color 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: inherit;
        }

        .quick-action-item:hover {
            background-color: #f8f9fa;
            border-color: #ddd;
        }

        .quick-action-icon {
            font-size: 28px;
            color: #1a3a6e;
            margin-bottom: 10px;
        }

        .quick-action-title {
            font-size: 15px;
            font-weight: bold;
            color: #333;
        }

        .activity-list {
            list-style: none;
            padding: 0;
            max-height: 350px;
            overflow-y: auto;
        }

        .activity-item {
            display: flex;
            gap: 15px;
            padding: 12px 5px;
            border-bottom: 1px solid #eee;
            align-items: flex-start;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-icon {
            font-size: 18px;
            color: #1a3a6e;
            padding-top: 3px;
            flex-shrink: 0;
            width: 25px;
            text-align: center;
        }

        .activity-content {
            flex: 1;
        }

        .activity-title {
            font-weight: bold;
            margin-bottom: 3px;
            font-size: 14px;
        }

        .activity-desc {
            color: #666;
            margin-bottom: 5px;
            font-size: 13px;
        }

        .activity-time {
            font-size: 11px;
            color: #999;
        }

        .activity-list .no-data {
            text-align: center;
            color: #777;
            padding: 20px;
            font-style: italic;
        }

        .safety-tips {
            list-style: none;
            padding: 0;
        }

        .safety-tips li {
            margin-bottom: 10px;
            padding-left: 22px;
            position: relative;
            font-size: 14px;
            line-height: 1.5;
        }

        .safety-tips li::before {
            content: "\f058";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            color: #28a745;
            position: absolute;
            left: 0;
            top: 2px;
        }

        .report-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        .map-container {
            height: 400px;
            background: #e9ecef;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            border: 2px solid #1a3a6e;
        }

        .map-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 1;
            pointer-events: none;
        }

        #map {
            width: 100%;
            height: 100%;
            z-index: 0;
        }

        .map-caption {
            font-size: 14px;
            color: #333;
            text-align: center;
            margin-top: 10px;
        }

        .form-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group.row {
            display: flex;
            gap: 20px;
        }

        .form-group.row .form-control {
            flex: 1;
        }

        .map-search-container {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            width: 80%;
            max-width: 500px;
        }

        .map-search-container input {
            width: 100%;
            padding: 12px 40px 12px 20px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            outline: none;
            transition: box-shadow 0.3s;
        }

        .map-search-container input:focus {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .map-search-container i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
            font-size: 18px;
        }

        .autocomplete-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: #fff;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            max-height: 200px;
            overflow-y: auto;
            z-index: 1001;
            display: none;
        }

        .autocomplete-item {
            padding: 10px 15px;
            cursor: pointer;
            font-size: 14px;
            color: #333;
            transition: background-color 0.2s;
        }

        .autocomplete-item:hover {
            background-color: #f0f0f0;
        }

        .rules-list {
            list-style: none;
            padding: 0;
        }

        .rules-list li {
            margin-bottom: 15px;
            padding-left: 25px;
            position: relative;
            font-size: 15px;
            line-height: 1.6;
        }

        .rules-list li::before {
            content: "\f0a9";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            color: #1a3a6e;
            position: absolute;
            left: 0;
            top: 2px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th,
        .table td {
            padding: 12px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .table th {
            background-color: #1a3a6e;
            color: #fff;
        }

        .status-badge {
            padding: 5px 10px;
            border-radius: 12px;
            font-size: 14px;
        }

        .status-badge.unpaid {
            background-color: #dc3545;
            color: #fff;
        }

        .status-badge.paid {
            background-color: #28a745;
            color: #fff;
        }

        .no-data {
            text-align: center;
            padding: 20px;
            color: #666;
        }

        .footer {
            background-color: #1a3a6e;
            color: #ccc;
            text-align: center;
            padding: 20px 0;
            margin-top: auto;
            font-size: 14px;
            border-top: 3px solid #ffcc00;
        }

        .footer a {
            color: #ffcc00;
            text-decoration: none;
            margin: 0 5px;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        .footer p {
            margin: 5px 0;
        }

        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            opacity: 0;
            transform: translateY(100%);
            transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
            min-width: 250px;
            text-align: center;
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .notification.success {
            background-color: #28a745;
            color: #fff;
        }

        .notification.info {
            background-color: #17a2b8;
            color: #fff;
        }

        @media (max-width: 992px) {
            .nav {
                gap: 10px;
            }
            .nav-link {
                font-size: 14px;
                padding: 6px 8px;
            }
            .features {
                grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            }
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            .report-grid {
                grid-template-columns: 1fr;
            }
            .map-container {
                height: 300px;
            }
            .map-search-container {
                width: 90%;
            }
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            .nav {
                justify-content: center;
                width: 100%;
            }
            .main {
                padding: 20px 0;
            }
            .form-container > .container {
                padding-top: 20px;
                padding-bottom: 20px;
            }
            .card {
                padding: 20px;
            }
            .card-title {
                font-size: 22px;
            }
            .features {
                grid-template-columns: 1fr;
            }
            .hero {
                padding: 30px 15px;
            }
            .hero .card-title {
                font-size: 24px;
            }
            .hero .hero-subtitle {
                font-size: 16px;
            }
            .activity-item {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }
            .activity-icon {
                margin-bottom: 5px;
            }
            .form-group.row {
                flex-direction: column;
                gap: 15px;
            }
        }

        @media (max-width: 480px) {
            .nav-link {
                font-size: 13px;
                gap: 4px;
                padding: 5px 6px;
            }
            .btn {
                font-size: 14px;
                padding: 10px 15px;
            }
            .card-title {
                font-size: 20px;
            }
            .hero .hero-actions .btn {
                margin: 5px;
            }
            .quick-actions-grid {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
                gap: 15px;
            }
            .quick-action-icon {
                font-size: 24px;
            }
            .quick-action-title {
                font-size: 14px;
            }
            .map-container {
                height: 250px;
            }
            .map-search-container {
                width: 95%;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="container header-content">
            <a href="#" class="logo" data-section="home">
                <i class="fas fa-road"></i> Road<span>Safety</span>
            </a>
            <nav class="nav" id="navigation">
                <a href="#" class="nav-link active" data-section="home"><i class="fas fa-home"></i> Home</a>
                <a href="#" class="nav-link" data-section="acts-rules"><i class="fas fa-book"></i> Acts & Rules</a>
                <a href="#" class="nav-link logged-out-item" data-section="login"><i class="fas fa-sign-in-alt"></i> Login</a>
                <a href="#" class="nav-link logged-out-item" data-section="register"><i class="fas fa-user-plus"></i> Register</a>
                <a href="#" class="nav-link logged-in-item" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a>
                <a href="#" class="nav-link logged-in-item" data-section="report-accident"><i class="fas fa-car-crash"></i> Report Accident</a>
                <a href="#" class="nav-link logged-in-item" data-section="view-violations"><i class="fas fa-exclamation-triangle"></i> View Violations</a>
                <a href="#" class="nav-link logged-in-item" data-section="pay-fines"><i class="fas fa-money-bill-wave"></i> Pay Fines</a>
                <a href="#" class="nav-link logged-in-item" data-section="logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </nav>
        </div>
    </header>

    <main class="main">
        <div id="home-section" class="form-container active">
            <div class="container">
                <section class="hero">
                    <h1 class="card-title"><i class="fas fa-shield-alt"></i> Road Safety Management System</h1>
                    <p class="hero-subtitle">Ensuring safer roads through effective management and reporting</p>
                    <div class="hero-actions logged-out-item">
                        <a href="#" class="btn btn-lg" data-section="login"><i class="fas fa-sign-in-alt"></i> Login to System</a>
                        <a href="#" class="btn btn-lg btn-secondary" data-section="register"><i class="fas fa-user-plus"></i> Register</a>
                    </div>
                    <div class="hero-actions logged-in-item">
                        <a href="#" class="btn btn-lg" data-section="dashboard"><i class="fas fa-arrow-right"></i> Go to Dashboard</a>
                    </div>
                </section>

                <div class="card">
                    <h2 class="card-title"><i class="fas fa-info-circle"></i> About Our System</h2>
                    <p>The Road Safety Management System (RSMS) is designed to help improve road safety by efficiently managing traffic violations, accident reports, and fines. With RSMS, users can:</p>
                    <ul style="margin: 20px 0 20px 40px; list-style: disc; line-height: 1.6;">
                        <li>Report accidents quickly and efficiently</li>
                        <li>View traffic violations associated with their account</li>
                        <li>Pay outstanding fines securely</li>
                        <li>Track road safety statistics and improvements</li>
                    </ul>
                    <p class="logged-out-item">Login to access these features and contribute to making our roads safer for everyone.</p>
                    <p class="logged-in-item">Navigate using the links above to manage your account and access services.</p>
                </div>

                <div class="features">
                    <div class="feature">
                        <div class="feature-icon"><i class="fas fa-car-crash"></i></div>
                        <div class="feature-content">
                            <h3>Accident Reporting</h3>
                            <p>Report accidents with detailed information and location data to help emergency services respond quickly.</p>
                        </div>
                    </div>
                    <div class="feature">
                        <div class="feature-icon"><i class="fas fa-exclamation-triangle"></i></div>
                        <div class="feature-content">
                            <h3>Violation Management</h3>
                            <p>Track and manage traffic violations with our comprehensive violation management system.</p>
                        </div>
                    </div>
                    <div class="feature">
                        <div class="feature-icon"><i class="fas fa-credit-card"></i></div>
                        <div class="feature-content">
                            <h3>Fine Payments</h3>
                            <p>Secure payment gateway for settling fines with instant confirmation and receipts.</p>
                        </div>
                    </div>
                    <div class="feature">
                        <div class="feature-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="feature-content">
                            <h3>Safety Analytics</h3>
                            <p>Access detailed analytics and reports to identify road safety trends and improvement areas.</p>
                        </div>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat">
                        <div class="stat-number" id="accidents-stat">0</div>
                        <div>Accidents Reported</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="violations-stat">0</div>
                        <div>Violations Processed</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="users-stat">0</div>
                        <div>Active Users</div>
                    </div>
                    <div class="stat">
                        <div class="stat-number" id="improvement-stat">0</div>
                        <div>Safety Improvement %</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="acts-rules-section" class="form-container">
            <div class="container">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-book"></i> Acts & Rules of RSMS</h2>
                    <ul class="rules-list">
                        <li><strong>Motor Vehicles Act, 1988:</strong> Comply with regulations for vehicle registration, licensing, and road safety standards.</li>
                        <li><strong>Speed Limits:</strong> Adhere to designated speed limits: 50 km/h in urban areas, 80 km/h on highways.</li>
                        <li><strong>Helmet and Seatbelt Laws:</strong> Mandatory use of helmets for two-wheeler riders and seatbelts for all vehicle occupants.</li>
                        <li><strong>No Mobile Use:</strong> Prohibited to use mobile phones while driving, except with hands-free devices.</li>
                        <li><strong>Drunk Driving:</strong> Zero tolerance for driving under the influence; legal limit is 0.03% BAC.</li>
                        <li><strong>Pedestrian Rights:</strong> Yield to pedestrians at crossings and ensure their safety.</li>
                        <li><strong>Vehicle Maintenance:</strong> Regular checks for brakes, tires, and lights to ensure roadworthiness.</li>
                    </ul>
                </div>
            </div>
        </div>

        <div id="login-section" class="form-container">
            <div class="container">
                <div class="card" style="max-width: 500px; margin: 0 auto;">
                    <h2 class="card-title"><i class="fas fa-sign-in-alt"></i> Login to System</h2>
                    <form id="loginForm">
                        <div class="form-group">
                            <label for="username">Username</label>
                            <input type="text" id="username" name="username" class="form-control" placeholder="Enter your username" required>
                        </div>
                        <div class="form-group">
                            <label for="password">Password</label>
                            <div style="position: relative;">
                                <input type="password" id="password" name="password" class="form-control" placeholder="Enter your password" required>
                                <i id="togglePassword" class="fas fa-eye" style="position: absolute; right: 15px; top: 15px; cursor: pointer; color: #777;"></i>
                            </div>
                        </div>
                        <div class="form-group" style="display: flex; justify-content: space-between; align-items: center;">
                            <label style="display: flex; align-items: center;">
                                <input type="checkbox" id="remember" name="remember" style="margin-right: 8px;">
                                Remember me
                            </label>
                            <a href="#" style="color: #1a3a6e; text-decoration: none;">Forgot password?</a>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-lg" style="width: 100%;"><i class="fas fa-sign-in-alt"></i> Login</button>
                        </div>
                        <div id="loginMessage" class="feedback-message"></div>
                    </form>
                    <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                        <p>Don't have an account? <a href="#" style="color: #1a3a6e; font-weight: bold; text-decoration: none;" data-section="register">Register here</a></p>
                    </div>
                </div>
            </div>
        </div>

        <div id="register-section" class="form-container">
            <div class="container">
                <div class="card" style="max-width: 500px; margin: 0 auto;">
                    <h2 class="card-title"><i class="fas fa-user-plus"></i> Register New User</h2>
                    <form id="registerForm">
                        <div class="form-group">
                            <label for="reg-username">Username</label>
                            <input type="text" id="reg-username" name="username" class="form-control" placeholder="Choose a username" required pattern="[a-zA-Z0-9]{4,}" title="Username must be at least 4 characters and contain only letters and numbers">
                        </div>
                        <div class="form-group">
                            <label for="reg-name">Full Name</label>
                            <input type="text" id="reg-name" name="name" class="form-control" placeholder="Enter your full name" required>
                        </div>
                        <div class="form-group">
                            <label for="reg-email">Email</label>
                            <input type="email" id="reg-email" name="email" class="form-control" placeholder="Enter your email" required>
                        </div>
                        <div class="form-group">
                            <label for="reg-phone">Phone Number</label>
                            <input type="text" id="reg-phone" name="phone" class="form-control" placeholder="Enter your phone number" pattern="[0-9]{10}" required title="Phone number must be 10 digits">
                        </div>
                        <div class="form-group">
                            <label for="reg-password">Password</label>
                            <div style="position: relative;">
                                <input type="password" id="reg-password" name="password" class="form-control" placeholder="Create a password" required pattern=".{6,}" title="Password must be at least 6 characters">
                                <i id="toggleRegPassword" class="fas fa-eye" style="position: absolute; right: 15px; top: 15px; cursor: pointer; color: #777;"></i>
                            </div>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-lg" style="width: 100%;"><i class="fas fa-user-plus"></i> Register</button>
                        </div>
                        <div id="registerMessage" class="feedback-message"></div>
                    </form>
                    <div style="text-align: center; margin-top: 20px; padding-top: 20px; border-top: 1px solid #eee;">
                        <p>Already have an account? <a href="#" style="color: #1a3a6e; font-weight: bold; text-decoration: none;" data-section="login">Login here</a></p>
                    </div>
                </div>
            </div>
        </div>

        <div id="dashboard-section" class="form-container">
            <div class="container">
                <div class="card welcome-card">
                    <h1 class="card-title"><i class="fas fa-user-circle"></i> Welcome Back!</h1>
                    <p>Hello, <span id="userName" style="font-weight: bold; color: #ffcc00;">User</span>. Manage profile/services.</p>
                </div>
                <div class="dashboard-grid">
                    <div class="dashboard-main">
                        <div class="card">
                            <h2 class="card-title"><i class="fas fa-bolt"></i> Quick Actions</h2>
                            <div class="quick-actions-grid">
                                <a href="#" class="quick-action-item" data-section="report-accident">
                                    <i class="quick-action-icon fas fa-car-crash"></i>
                                    <span class="quick-action-title">Report</span>
                                </a>
                                <a href="#" class="quick-action-item" data-section="view-violations">
                                    <i class="quick-action-icon fas fa-list-check"></i>
                                    <span class="quick-action-title">Violations</span>
                                </a>
                                <a href="#" class="quick-action-item" data-section="pay-fines">
                                    <i class="quick-action-icon fas fa-credit-card"></i>
                                    <span class="quick-action-title">Fines</span>
                                </a>
                                <a href="#" class="quick-action-item" data-section="acts-rules">
                                    <i class="quick-action-icon fas fa-book"></i>
                                    <span class="quick-action-title">Rules</span>
                                </a>
                            </div>
                        </div>
                        <div class="card">
                            <h2 class="card-title"><i class="fas fa-history"></i> Recent Activity</h2>
                            <ul class="activity-list" id="activityList">
                                <li class="no-data">No activity.</li>
                            </ul>
                        </div>
                    </div>
                    <div class="dashboard-sidebar">
                        <div class="stats-container">
                            <div class="stats-card card">
                                <div class="stats-icon"><i class="fas fa-exclamation-triangle"></i></div>
                                <div class="stats-value" id="violationsCount">0</div>
                                <div class="stats-label">Violations</div>
                                <a href="#" class="btn btn-sm" data-section="view-violations">View</a>
                            </div>
                            <div class="stats-card card">
                                <div class="stats-icon"><i class="fas fa-file-invoice-dollar"></i></div>
                                <div class="stats-value" id="finesAmount">$0.00</div>
                                <div class="stats-label">Fines Due</div>
                                <a href="#" class="btn btn-sm" data-section="pay-fines">Pay</a>
                            </div>
                        </div>
                        <div class="card">
                            <h2 class="card-title"><i class="fas fa-lightbulb"></i> Safety Tips</h2>
                            <ul class="safety-tips">
                                <li>Wear seatbelts.</li>
                                <li>Follow speed limits.</li>
                                <li>Avoid phone use.</li>
                                <li>Keep distance.</li>
                                <li>No impaired driving.</li>
                                <li>Yield to pedestrians.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="report-accident-section" class="form-container">
            <div class="container">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-car-crash"></i> Report an Accident</h2>
                    <p style="margin-bottom: 20px;">Provide detailed information about the accident to assist emergency services. All fields marked with * are required.</p>
                    <div class="report-grid">
                        <div class="map-section">
                            <div class="map-container" id="mapContainer">
                                <div id="map"></div>
                                <div class="map-search-container">
                                    <input type="text" id="map-search" class="form-control" placeholder="Search for a location...">
                                    <i class="fas fa-search"></i>
                                    <div class="autocomplete-dropdown" id="autocomplete-dropdown"></div>
                                </div>
                                <div class="map-overlay"></div>
                            </div>
                            <div class="map-caption">Click on the map or search to set the accident location</div>
                            <div class="form-group">
                                <label for="accident-coordinates">Coordinates (Lat, Lng)</label>
                                <input type="text" id="accident-coordinates" name="coordinates" class="form-control" placeholder="e.g., 13.0827, 80.2707" readonly>
                            </div>
                        </div>
                        <div class="form-section">
                            <form id="accidentForm">
                                <div class="form-group">
                                    <label for="accident-location">Location *</label>
                                    <input type="text" id="accident-location" name="location" class="form-control" placeholder="Enter street address or landmark" required>
                                </div>
                                <div class="form-group row">
                                    <div class="form-group">
                                        <label for="accident-date">Date *</label>
                                        <input type="date" id="accident-date" name="date" class="form-control" required max="2025-05-07">
                                    </div>
                                    <div class="form-group">
                                        <label for="accident-time">Time *</label>
                                        <input type="time" id="accident-time" name="time" class="form-control" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="accident-severity">Severity *</label>
                                    <select id="accident-severity" name="severity" class="form-control" required>
                                        <option value="" disabled selected>Select severity</option>
                                        <option value="Minor">Minor (No injuries)</option>
                                        <option value="Moderate">Moderate (Minor injuries)</option>
                                        <option value="Severe">Severe (Serious injuries)</option>
                                        <option value="Fatal">Fatal</option>
                                    </select>
                                </div>
                                <div class="form-group row">
                                    <div class="form-group">
                                        <label for="accident-vehicles">Number of Vehicles *</label>
                                        <input type="number" id="accident-vehicles" name="vehicles" class="form-control" min="1" required placeholder="e.g., 2">
                                    </div>
                                    <div class="form-group">
                                        <label for="accident-injuries">Number of Injuries</label>
                                        <input type="number" id="accident-injuries" name="injuries" class="form-control" min="0" placeholder="e.g., 0">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="accident-description">Description *</label>
                                    <textarea id="accident-description" name="description" class="form-control" rows="5" placeholder="Describe the accident in detail (e.g., cause, vehicles involved, conditions)" required></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="accident-image">Upload Images (Optional, max 3)</label>
                                    <input type="file" id="accident-image" name="image" class="form-control" accept="image/*" multiple>
                                    <small style="color: #666;">Max file size: 5MB each</small>
                                </div>
                                <div class="form-group" style="display: flex; gap: 10px; justify-content: flex-end;">
                                    <button type="submit" class="btn btn-success"><i class="fas fa-paper-plane"></i> Submit Report</button>
                                    <a href="#" class="btn btn-secondary" data-section="dashboard"><i class="fas fa-arrow-left"></i> Back to Dashboard</a>
                                </div>
                                <div id="accidentMessage" class="feedback-message"></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="view-violations-section" class="form-container">
            <div class="container">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-exclamation-triangle"></i> Violations</h2>
                    <div id="violationsTable"></div>
                </div>
            </div>
        </div>

        <div id="pay-fines-section" class="form-container">
            <div class="container">
                <div class="card">
                    <h2 class="card-title"><i class="fas fa-money-bill-wave"></i> Pay Fines</h2>
                    <form id="fineForm">
                        <div class="form-group">
                            <label for="fine_id">Fine ID</label>
                            <input type="text" id="fine_id" name="fine_id" class="form-control" placeholder="Enter Fine ID" required>
                        </div>
                        <div class="form-group">
                            <label for="card_number">Card Number</label>
                            <input type="text" id="card_number" name="card_number" class="form-control" placeholder="1234 5678 9012 3456" required>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-success btn-lg"><i class="fas fa-credit-card"></i> Pay</button>
                            <a href="#" class="btn btn-secondary btn-lg" data-section="dashboard"><i class="fas fa-times"></i> Cancel</a>
                        </div>
                        <div id="fineMessage" class="feedback-message"></div>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer" id="footer">
        <div class="container">
            <p id="copyright-text">© <span id="current-year"></span> Road Safety Management System. All rights reserved. | <a href="#">Privacy Policy</a> | <a href="#">Terms of Service</a> | <span id="dynamic-link"></span></p>
            <p style="font-size: 12px;">Images sourced from Unsplash and Wikimedia Commons. Maps powered by OpenStreetMap.</p>
        </div>
    </footer>

    <div class="notification" id="notification"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        let currentUser = null;
        let isLoggedIn = false;

        const mockViolations = [
            { id: "V001", type: "Speeding", date: "2025-04-01", amount: 100, status: "Unpaid" },
            { id: "V002", type: "Parking", date: "2025-03-15", amount: 50, status: "Paid" }
        ];

        const mockUserData = {
            "john_doe": { name: "John Doe", password: "password123", violations: 3, fines: 250 },
            "jane_smith": { name: "Jane Smith", password: "password456", violations: 1, fines: 50 }
        };

        if (!localStorage.getItem('users')) {
            localStorage.setItem('users', JSON.stringify([]));
        }
        if (!localStorage.getItem('accidents')) {
            localStorage.setItem('accidents', JSON.stringify([]));
        }

        function updateNavVisibility() {
            const loggedInItems = document.querySelectorAll('.logged-in-item');
            const loggedOutItems = document.querySelectorAll('.logged-out-item');
            loggedInItems.forEach(item => {
                item.style.display = isLoggedIn ? 'flex' : 'none';
            });
            loggedOutItems.forEach(item => {
                item.style.display = isLoggedIn ? 'none' : 'flex';
            });
            document.querySelector('.nav-link[data-section="home"]').style.display = 'flex';
            document.querySelector('.nav-link[data-section="acts-rules"]').style.display = 'flex';
            updateFooter();
        }

        function updateFooter() {
            const yearElement = document.getElementById('current-year');
            const dynamicLink = document.getElementById('dynamic-link');
            if (yearElement) {
                yearElement.textContent = new Date().getFullYear();
            }
            if (dynamicLink) {
                if (isLoggedIn) {
                    dynamicLink.innerHTML = '<a href="#">Contact Support</a>';
                } else {
                    dynamicLink.innerHTML = '<a href="#">Learn More</a>';
                }
            }
        }

        function navigateToSection(event, sectionId) {
            if (event) event.preventDefault();

            // Handle logout separately
            if (sectionId === 'logout') {
                logout();
                return;
            }

            // Check for restricted sections
            const restrictedSections = ['dashboard', 'report-accident', 'view-violations', 'pay-fines'];
            if (restrictedSections.includes(sectionId) && !isLoggedIn) {
                showNotification("Please log in to access this feature.", "info");
                sectionId = 'login';
            }

            // Update section visibility
            document.querySelectorAll('.form-container').forEach(section => {
                section.classList.remove('active');
            });

            // Update navigation link states
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });

            const targetSection = document.getElementById(`${sectionId}-section`);
            const navLink = document.querySelector(`.nav-link[data-section="${sectionId}"]`);

            if (targetSection) {
                targetSection.classList.add('active');
                if (navLink) navLink.classList.add('active');
                document.querySelector('.main').scrollIntoView({ behavior: 'smooth' });
            } else {
                // Fallback to home section
                document.getElementById('home-section').classList.add('active');
                document.querySelector('.nav-link[data-section="home"]').classList.add('active');
                sectionId = 'home';
            }

            updateNavVisibility();

            // Initialize the appropriate section
            if (sectionId === 'home') initHome();
            else if (sectionId === 'acts-rules') initActsRules();
            else if (sectionId === 'dashboard') initDashboard();
            else if (sectionId === 'report-accident') initReportAccident();
            else if (sectionId === 'view-violations') initViolations();
            else if (sectionId === 'pay-fines') initPayFines();
            else if (sectionId === 'login') initLogin();
            else if (sectionId === 'register') initRegister();
        }

        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3500);
        }

        function logout() {
            currentUser = null;
            isLoggedIn = false;
            updateNavVisibility();
            navigateToSection(null, 'home');
            showNotification("You have been logged out successfully.", "success");
        }

        function initHome() {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && entry.target.classList.contains('stats')) {
                        animateStats();
                    }
                });
            }, { threshold: 0.1 });

            const statsSection = document.querySelector('.stats');
            if (statsSection) {
                observer.observe(statsSection);
            }
        }

        function animateStats() {
            const stats = [
                { id: 'accidents-stat', target: 1254 },
                { id: 'violations-stat', target: 8743 },
                { id: 'users-stat', target: 5280 },
                { id: 'improvement-stat', target: 24 }
            ];
            stats.forEach(stat => {
                const element = document.getElementById(stat.id);
                if (!element) return;
                let current = 0;
                const increment = Math.ceil(stat.target / 100);
                const timer = setInterval(() => {
                    current += increment;
                    if (current >= stat.target) {
                        element.textContent = stat.target;
                        clearInterval(timer);
                    } else {
                        element.textContent = current;
                    }
                }, 20);
            });
        }

        function initActsRules() {
        }

        function initDashboard() {
            if (!isLoggedIn || !currentUser) return;

            const userNameElement = document.getElementById('userName');
            if (userNameElement) {
                userNameElement.textContent = mockUserData[currentUser.username]?.name || currentUser.name || 'User';
            }

            const violationsCount = document.getElementById('violationsCount');
            const finesAmount = document.getElementById('finesAmount');
            if (violationsCount) {
                violationsCount.textContent = mockUserData[currentUser.username]?.violations || 0;
            }
            if (finesAmount) {
                finesAmount.textContent = `$${(mockUserData[currentUser.username]?.fines || 0).toFixed(2)}`;
            }

            const activityList = document.getElementById('activityList');
            if (activityList) {
                activityList.innerHTML = '';
                const activities = [
                    { type: 'violation', title: 'Speed Violation', description: 'ID: V001', time: '3d ago', icon: 'fa-gauge-high' },
                    { type: 'payment', title: 'Fine Paid', description: 'ID: V002', time: '1w ago', icon: 'fa-check-circle' }
                ];
                if (activities.length > 0) {
                    activities.forEach(activity => {
                        const li = document.createElement('li');
                        li.className = 'activity-item';
                        li.innerHTML = `
                            <div class="activity-icon"><i class="fas ${activity.icon}"></i></div>
                            <div class="activity-content">
                                <div class="activity-title">${activity.title}</div>
                                <div class="activity-desc">${activity.description}</div>
                                <div class="activity-time">${activity.time}</div>
                            </div>
                        `;
                        activityList.appendChild(li);
                    });
                } else {
                    activityList.innerHTML = '<li class="no-data">No activity.</li>';
                }
            }

            showNotification(`Welcome, ${currentUser?.name || 'User'}!`, 'success');
        }

        function initLogin() {
            const form = document.getElementById('loginForm');
            const message = document.getElementById('loginMessage');
            const togglePassword = document.getElementById('togglePassword');
            const passwordInput = document.getElementById('password');

            if (!form || !message || !togglePassword || !passwordInput) return;

            togglePassword.addEventListener('click', () => {
                const type = passwordInput.type === 'password' ? 'text' : 'password';
                passwordInput.type = type;
                togglePassword.classList.toggle('fa-eye');
                togglePassword.classList.toggle('fa-eye-slash');
            });

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }

                const username = document.getElementById('username').value.trim().toLowerCase();
                const password = document.getElementById('password').value;
                const submitButton = form.querySelector('button[type="submit"]');
                const originalButtonText = submitButton.innerHTML;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Logging in...';
                submitButton.disabled = true;

                setTimeout(() => {
                    const users = JSON.parse(localStorage.getItem('users')) || [];
                    let user = users.find(u => u.username === username && u.password === password);

                    if (!user && mockUserData[username] && mockUserData[username].password === password) {
                        user = { username, name: mockUserData[username].name, password };
                        users.push(user);
                        localStorage.setItem('users', JSON.stringify(users));
                    }

                    submitButton.innerHTML = originalButtonText;
                    submitButton.disabled = false;

                    if (user) {
                        currentUser = { username, name: user.name };
                        isLoggedIn = true;
                        message.className = 'feedback-message success';
                        message.style.display = 'block';
                        message.innerHTML = '<i class="fas fa-check-circle"></i> Login successful! Redirecting...';
                        setTimeout(() => {
                            form.reset();
                            message.style.display = 'none';
                            navigateToSection(null, 'dashboard');
                        }, 2000);
                    } else {
                        message.className = 'feedback-message error';
                        message.style.display = 'block';
                        message.innerHTML = '<i class="fas fa-exclamation-circle"></i> Invalid username or password';
                    }
                }, 1000);
            });
        }

        function initRegister() {
            const form = document.getElementById('registerForm');
            const message = document.getElementById('registerMessage');
            const togglePassword = document.getElementById('toggleRegPassword');
            const passwordInput = document.getElementById('reg-password');

            if (!form || !message || !togglePassword || !passwordInput) return;

            togglePassword.addEventListener('click', () => {
                const type = passwordInput.type === 'password' ? 'text' : 'password';
                passwordInput.type = type;
                togglePassword.classList.toggle('fa-eye');
                togglePassword.classList.toggle('fa-eye-slash');
            });

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }

                const username = document.getElementById('reg-username').value.trim();
                const name = document.getElementById('reg-name').value.trim();
                const email = document.getElementById('reg-email').value.trim();
                const phone = document.getElementById('reg-phone').value.trim();
                const password = document.getElementById('reg-password').value;
                const submitButton = form.querySelector('button[type="submit"]');
                const originalButtonText = submitButton.innerHTML;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Registering...';
                submitButton.disabled = true;

                setTimeout(() => {
                    const users = JSON.parse(localStorage.getItem('users')) || [];
                    const existingUser = users.find(u => u.username === username || u.email === email);

                    submitButton.innerHTML = originalButtonText;
                    submitButton.disabled = false;

                    if (existingUser) {
                        message.className = 'feedback-message error';
                        message.style.display = 'block';
                        message.innerHTML = '<i class="fas fa-exclamation-circle"></i> Username or email already exists';
                    } else {
                        users.push({ username, name, email, phone, password });
                        localStorage.setItem('users', JSON.stringify(users));
                        message.className = 'feedback-message success';
                        message.style.display = 'block';
                        message.innerHTML = '<i class="fas fa-check-circle"></i> Registration successful! Redirecting to login...';
                        setTimeout(() => {
                            form.reset();
                            message.style.display = 'none';
                            navigateToSection(null, 'login');
                        }, 2000);
                    }
                }, 1000);
            });
        }

        function initReportAccident() {
            const form = document.getElementById('accidentForm');
            const message = document.getElementById('accidentMessage');
            const dateInput = document.getElementById('accident-date');
            const timeInput = document.getElementById('accident-time');
            const locationInput = document.getElementById('accident-location');
            const severityInput = document.getElementById('accident-severity');
            const vehiclesInput = document.getElementById('accident-vehicles');
            const injuriesInput = document.getElementById('accident-injuries');
            const imageInput = document.getElementById('accident-image');
            const coordinatesInput = document.getElementById('accident-coordinates');
            const mapContainer = document.getElementById('map');
            const searchInput = document.getElementById('map-search');
            const autocompleteDropdown = document.getElementById('autocomplete-dropdown');

            if (!form || !message || !dateInput || !timeInput || !locationInput || !severityInput || !vehiclesInput || !injuriesInput || !imageInput || !coordinatesInput || !mapContainer || !searchInput || !autocompleteDropdown) return;

            const map = L.map('map').setView([13.0827, 80.2707], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '© OpenStreetMap contributors'
            }).addTo(map);

            let marker = null;

            map.on('click', function(e) {
                const lat = e.latlng.lat.toFixed(4);
                const lng = e.latlng.lng.toFixed(4);
                coordinatesInput.value = `${lat}, ${lng}`;

                if (marker) {
                    map.removeLayer(marker);
                }

                marker = L.marker([lat, lng]).addTo(map)
                    .bindPopup(`📍 Selected: ${lat}, ${lng}`)
                    .openPopup();

                fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=18&addressdetails=1`)
                    .then(response => response.json())
                    .then(data => {
                        if (data && data.display_name) {
                            locationInput.value = data.display_name;
                            showNotification(`Location set to ${locationInput.value}`, 'success');
                        } else {
                            locationInput.value = 'Unknown location';
                            showNotification('Location set, but address could not be determined', 'info');
                        }
                    })
                    .catch(error => {
                        locationInput.value = 'Unknown location';
                        showNotification('Error fetching location name', 'error');
                    });
            });

            let searchTimeout;
            searchInput.addEventListener('input', () => {
                clearTimeout(searchTimeout);
                const query = searchInput.value.trim();
                if (query.length < 3) {
                    autocompleteDropdown.style.display = 'none';
                    return;
                }

                searchTimeout = setTimeout(() => {
                    fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=5`)
                        .then(response => response.json())
                        .then(data => {
                            autocompleteDropdown.innerHTML = '';
                            if (data.length === 0) {
                                autocompleteDropdown.style.display = 'none';
                                return;
                            }

                            data.forEach(item => {
                                const div = document.createElement('div');
                                div.className = 'autocomplete-item';
                                div.textContent = item.display_name;
                                div.addEventListener('click', () => {
                                    const lat = parseFloat(item.lat);
                                    const lng = parseFloat(item.lon);
                                    map.setView([lat, lng], 15);
                                    coordinatesInput.value = `${lat.toFixed(4)}, ${lng.toFixed(4)}`;
                                    locationInput.value = item.display_name;

                                    if (marker) {
                                        map.removeLayer(marker);
                                    }
                                    marker = L.marker([lat, lng]).addTo(map)
                                        .bindPopup(`📍 ${item.display_name}`)
                                        .openPopup();

                                    autocompleteDropdown.style.display = 'none';
                                    showNotification(`Location set to ${item.display_name}`, 'success');
                                });
                                autocompleteDropdown.appendChild(div);
                            });

                            autocompleteDropdown.style.display = 'block';
                        })
                        .catch(error => {
                            autocompleteDropdown.style.display = 'none';
                            showNotification('Error searching for location', 'error');
                        });
                }, 500);
            });

            document.addEventListener('click', (e) => {
                if (!searchInput.contains(e.target) && !autocompleteDropdown.contains(e.target)) {
                    autocompleteDropdown.style.display = 'none';
                }
            });

            const now = new Date();
            dateInput.valueAsDate = now;
            timeInput.value = now.toTimeString().slice(0, 5);
            locationInput.value = 'Chennai, Tamil Nadu';
            dateInput.max = now.toISOString().split('T')[0];

            imageInput.addEventListener('change', () => {
                const files = imageInput.files;
                if (files.length > 3) {
                    showNotification('Maximum 3 images allowed', 'error');
                    imageInput.value = '';
                    return;
                }
                for (let file of files) {
                    if (file.size > 5 * 1024 * 1024) {
                        showNotification('Each image must be under 5MB', 'error');
                        imageInput.value = '';
                        return;
                    }
                }
            });

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }

                const submitButton = form.querySelector('button[type="submit"]');
                const originalButtonText = submitButton.innerHTML;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
                submitButton.disabled = true;

                const accidents = JSON.parse(localStorage.getItem('accidents')) || [];
                const imageFiles = Array.from(imageInput.files).map(file => file.name);

                accidents.push({
                    location: locationInput.value,
                    coordinates: coordinatesInput.value,
                    date: dateInput.value,
                    time: timeInput.value,
                    severity: severityInput.value,
                    vehicles: vehiclesInput.value,
                    injuries: injuriesInput.value || 0,
                    description: document.getElementById('accident-description').value,
                    images: imageFiles
                });

                localStorage.setItem('accidents', JSON.stringify(accidents));

                message.className = 'feedback-message success';
                message.style.display = 'block';
                message.textContent = 'Accident report submitted successfully!';
                setTimeout(() => {
                    submitButton.innerHTML = originalButtonText;
                    submitButton.disabled = false;
                    form.reset();
                    dateInput.valueAsDate = new Date();
                    timeInput.value = new Date().toTimeString().slice(0, 5);
                    locationInput.value = 'Chennai, Tamil Nadu';
                    severityInput.value = '';
                    vehiclesInput.value = '';
                    injuriesInput.value = '';
                    coordinatesInput.value = '';
                    searchInput.value = '';
                    if (marker) map.removeLayer(marker);
                    marker = null;
                    message.style.display = 'none';
                    navigateToSection(null, 'dashboard');
                }, 1500);
            });
        }

        function initViolations() {
            const tableContainer = document.getElementById('violationsTable');
            if (!tableContainer) return;

            if (mockViolations.length === 0) {
                tableContainer.innerHTML = '<p class="no-data">No violations found.</p>';
                return;
            }

            let html = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Type</th>
                            <th>Date</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            mockViolations.forEach(v => {
                html += `
                    <tr>
                        <td>${v.id}</td>
                        <td>${v.type}</td>
                        <td>${v.date}</td>
                        <td>$${v.amount}</td>
                        <td><span class="status-badge ${v.status.toLowerCase()}">${v.status}</span></td>
                        <td>
                            ${v.status === 'Unpaid' ? `<a href="#" class="btn" data-section="pay-fines" data-fine-id="${v.id}">Pay</a>` : '-'}
                        </td>
                    </tr>
                `;
            });
            html += '</tbody></table>';
            tableContainer.innerHTML = html;
        }

        function navigateToPayFine(event, fineId) {
            navigateToSection(event, 'pay-fines');
            const fineIdInput = document.getElementById('fine_id');
            if (fineIdInput) fineIdInput.value = fineId;
        }

        function initPayFines() {
            const form = document.getElementById('fineForm');
            const message = document.getElementById('fineMessage');
            if (!form || !message) return;

            form.addEventListener('submit', (e) => {
                e.preventDefault();
                if (!form.checkValidity()) {
                    form.reportValidity();
                    return;
                }

                const fineId = document.getElementById('fine_id').value.trim();
                const cardNumber = document.getElementById('card_number').value.trim();
                const submitButton = form.querySelector('button[type="submit"]');
                const originalButtonText = submitButton.innerHTML;
                submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
                submitButton.disabled = true;

                setTimeout(() => {
                    const violation = mockViolations.find(v => v.id === fineId && v.status === 'Unpaid');
                    if (violation) {
                        violation.status = 'Paid';
                        message.className = 'feedback-message success';
                        message.style.display = 'block';
                        message.innerHTML = `<i class="fas fa-check-circle"></i> Fine ${fineId} paid successfully!`;
                        setTimeout(() => {
                            form.reset();
                            message.style.display = 'none';
                            navigateToSection(null, 'dashboard');
                        }, 2000);
                    } else {
                        message.className = 'feedback-message error';
                        message.style.display = 'block';
                        message.innerHTML = '<i class="fas fa-exclamation-circle"></i> Invalid Fine ID or already paid';
                    }
                    submitButton.innerHTML = originalButtonText;
                    submitButton.disabled = false;
                }, 1000);
            });
        }

        // Initialize navigation
        function setupNavigation() {
            const navLinks = document.querySelectorAll('[data-section]');
            navLinks.forEach(link => {
                link.addEventListener('click', (event) => {
                    const sectionId = link.getAttribute('data-section');
                    if (sectionId) {
                        navigateToSection(event, sectionId);
                    }
                });
            });
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateNavVisibility();
            setupNavigation();
            initHome();
            initLogin();
            initRegister();
        });
    </script>
</body>
</html>